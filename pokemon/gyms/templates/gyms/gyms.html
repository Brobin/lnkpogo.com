{% extends "base.html" %}

{% load staticfiles %}

{% block title %}Lincoln Gym Control{% endblock %}

{% block content %}
<h1>Lincoln Gym Control</h1>

<hr/>

<ul class="nav nav-tabs">
  <li class="active"><a href="#day" data-toggle="tab" onclick="filter(1);">Past Day</a></li>
  <li><a href="#week" data-toggle="tab" onclick="filter(7);">Past Week</a></li>
  <li><a href="#all" data-toggle="tab" onclick="filter(1000000);">All Time</a></li>
</ul>

<div class="well">
    <canvas id="gyms" height="400"></canvas>
</div>

<hr/>

<div class="row">
  <div class="col-sm-4">
    <div class="well text-center">
      <h2 class="text-info">Mystic</h2>
      <h3 style="font-size:40px" data-bind="text: avgMystic"></h3>
      <p>Min: <b class="text-danger" data-bind="text: minMystic"></b> Max: <b class="text-success" data-bind="text: maxMystic"></b></p>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="well text-center">
      <h2 class="text-danger">Valor</h2>
      <h3 style="font-size:40px" data-bind="text: avgValor"></h3>
      <p>Min: <b class="text-danger" data-bind="text: minValor"></b> Max: <b class="text-success" data-bind="text: maxValor"></b></p>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="well text-center">
      <h2 class="text-warning">Instinct</h2>
      <h3 style="font-size:40px" data-bind="text: avgInstinct"></h3>
      <p>Min: <b class="text-danger" data-bind="text: minInstinct"></b> Max: <b class="text-success" data-bind="text: maxInstinct"></b></p>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/gyms.js' %}"></script>
<script>
  var model = new GymViewModel([{% for log in logs %}
    new GymLog(new Date("{{ log.created_at|date:'M d Y h:i A' }}{{ log.created_at|time:'M' }}"), {{ log.mystic }}, {{ log.valor}}, {{ log.instinct }}),{% endfor %}
  ]);

  var chart = new Chart($('#gyms'), {
    type: 'line',
    data: {
      labels: model.labels(),
      datasets: model.chartData()
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      tooltips: {
        mode: 'label',
        intersect: false
      },
      hover: {
        mode: 'label'
      },
      scales: {
        xAxes :[{
          type: 'time',
          time: {
            tooltipFormat: 'MMM D YYYY h:mm A',
            unit: 'hour'
          }
        }]
      },
      elements: {
        point: {
          radius: 0
        }
      }
    }
  });

  ko.applyBindings(model);

  function filter(num) {
    model.filter(num)
    chart.data.labels = model.labels();
    chart.data.datasets = model.chartData();
    chart.update();
  }
  
</script>
{% endblock %}